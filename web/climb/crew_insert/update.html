<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>크루 수정</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
        crossorigin="anonymous"></script>
        <link rel="stylesheet" href="../crew_insert/update.css">
        <script src="https://kit.fontawesome.com/cccee664d4.js" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-1.12.4.js"
        integrity="sha256-Qw82+bXyGq6MydymqBxNPYTaUXXq7c8v3CwiYwLLNXU=" crossorigin="anonymous"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            list-style: none;
            text-decoration: none;
            box-sizing: border-box;
        }
        td{
            padding-bottom: 20px;
        }

        #profile {
            height: 25px;
            border-radius: 50%;
            overflow: hidden;
        }

     
        #crewphoto{
            padding-right: 200px;
        }
        .section {
            padding: 5% 0 5% 0;
            display: flex;
            justify-content: center;
            
        }

        .box {
            display: flex;
            flex-direction: row;
            justify-content: center;
            max-width: 1000px;
        }

        .nav2 {
            text-align: left;
            width: 20%;
            min-width: 150px;
            background-color: white;
            padding: 10px 0 0 30px;
            border: 1px solid rgb(220, 220, 220);
            border-radius: 8px 0 0 8px;
        }

        .text_bold {
            font-weight: bold;
        }

        .edit_section {
            min-width: 600px;
            background-color: white;
            padding: 35px 20px 35px 50px;
            border-top: 1px solid rgb(220, 220, 220);
            border-bottom: 1px solid rgb(220, 220, 220);
            border-right: 1px solid rgb(220, 220, 220);
            border-radius: 0 8px 8px 0;
            display: flex;
            justify-content: flex-start;
        }

        #hiking {
            height: 250px;
            width: 250px;
            overflow: hidden;
        }

        .edit_section{
            box-shadow: rgba(0, 0, 0, 0.08) 0px 1px 12px;
        }
        .edit_section label {
            font-weight: bold;
            min-width: 130px;
            font-size: 17px;
        }

        .edit_section input {
            padding: 8px;
            line-height: 40px;
            font-size: 15px;
            height: 55px;
        }

        .edit_section input[type="submit"] {
            margin-top: 30px;
            background-color: rgb(70, 70, 70);
            max-width: 120px;
            height: 40px;
            line-height: 20px;
            font-size: 15px;
            float: right;
        }

        .edit_section input[type=file] {
            margin-top: 20px;
        }

        #crewintro {
            min-height: 180px;
        }
        .form-control-lg {
            padding: 1.0rem 1.0rem;
        }

    </style>
</head>

<body>
    <div class="action">
        <div id="home" class="big-bg">
            <div class="header wrapper">
                <div class="logo">
                    <h1><a href="#">오를래</a></h1>
                </div>
                <div class="nav">
                    <ul>
                        <li><a href="#">MAIN</a></li>
                        <li><a href="#">HIKING</a></li>
                        <li><a href="#">CREW</a></li>
                        <li><a href="#">COMMUNITY</a></li>
                        <div class="icon" onclick="menuToggle();">
                            <a href="#"><i class="far fa-user"></i></a>
                        </div>
                </div>
                <div class="menu">
                    <ul>
                        <li><a href="#">로그인</a></li>
                        <li><a href="#">회원가입</a></li>
                        <li><a href="#">내 크루</a></li>
                        <li><a href="#">내 피드</a></li>
                        <li><a href="#">마이페이지</a></li>
                        <li><a href="#">로그아웃</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="section">
        <div class="box">
            
            <div class="edit_section">
                <form>
                    <table>
                        <tr>
                            <div class="create"><h1>생성하기</h1></div>
                            <td>
                                <label for="crewname">크루명</label>
                            </td>
                            <td>
                                <input type="text" id="crewname" name="crewname" class="form-control"
                                placeholder="원래 크루명이 자동으로 뜨도록 처리">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="crewname">크루 사진</label>
                            </td>
                            <td>
                                <img id="hiking" src="../images/다운로드 (10)_adobespark.jpeg">
                                <input type="file" id="crewphoto" name="crewphoto" class="form-control form-control-lg">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label for="crewintro">크루 소개글</label>
                            </td>
                            <td>
                                <input type="text" id="crewintro" name="crewintro" class="form-control"
                                placeholder="새로운 크루 소개글을 입력해주세요!">
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <mini-editor placeholder="내용을 입력하세요 (#해시태그 @멘션)"  ></mini-editor>
                                
                            </td>
                            
                        </tr>
                            <td></td>
                            <td>
                                <input type="submit" value="수정" class="form-control btn-secondary">
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="footer-col">
            <ul>
                <h3>MY ACCOUNT</h3>
                <li><a href="#">footer</a></li>
                <li><a href="#">footer</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <ul>
                <h3>MY ACCOUNT</h3>
                <li><a href="#">footer</a></li>
                <li><a href="#">footer</a></li>                           
            </ul>
        </div>
        <div class="footer-col">
            <ul>
                <h3>MY ACCOUNT</h3>
                <li><a href="#">MY PAGE</a></li>
                <li><a href="#">MY ORDER</a></li>
                <li><a href="#">MEMBERSHIP</a></li>
                <li><a href="#">LOGIN</a></li>
                <li><a href="#">JOIN US</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <ul>
                <h3>MY ACCOUNT</h3>
                <li><a href="#">footer</a></li>
            <li><a href="#">footer</a></li>
        </ul>
    </div>
    <div class="footer-col">
        <ul>
            <h3>MY ACCOUNT</h3>
            <li><a href="#">footer</a></li>
            <li><a href="#">footer</a></li>  
        </ul>
    </div>     
</div>
    <script>
        function menuToggle(){
            const toggleMenu = document.querySelector('.menu');
            toggleMenu.classList.toggle('active')
        }
        class MiniEditor extends HTMLElement {
  constructor(){
    super();
    this._value = '';
  }

  connectedCallback(){
    var shadow = this.attachShadow({ mode:'open'});
    var wrapper = document.createElement('div');
    var placeholder = document.createElement('div');
    var outp = document.createElement('div');
    var inp = document.createElement('div');

    wrapper.setAttribute('class', 'editor-body');

    var style = document.createElement('style');
    style.textContent = `
    div.editor-body {
      width:100%;
      height:100%;
      overflow-y:auto;
      overflow-x:none;
      min-height:7em;
      border-top:solid 1px #eee;
      border-bottom:solid 1px #eee;
      position:relative;
      box-sizing:border-box;
    }

    div.editor-body>div {
      box-sizing:border-box;
      padding:1rem;
    }

    div.outp, div.placeholder{
      pointer-events:none;
    }

    div.outp>span.hashtag{
        background:#69c;
      color:white;
      border-radius:.5em;
      padding:0 .2em;
      margin:0 -.2em;
    }
    div.outp>span.mention{
      color:bule;
    }

    div.placeholder {
      color:#999;
    }

    .inp {
      z-index:1;
    }
    div.outp {
      z-index:2;
    }

    div.outp, .inp, div.placeholder {
      text-align:left;
      width:100%;
      height:auto;
      min-height:100%;
      position:absolute;
      top:0;
      left:0;
      overflow-y:visible;
    }
    div.outp:focus, .inp:focus, div.placeholder:focus {
      outline:none;
    }
    `;

    placeholder.setAttribute('class', 'placeholder');
    if( this.hasAttribute('placeholder') ){
      placeholder.innerHTML = this.getAttribute('placeholder');
    }else{
      console.log(this.hasAttribute('placeholder'));
      placeholder.innerHTML = '';
    }



    outp.setAttribute('class', 'outp');
    inp.setAttribute('class', 'inp');
    inp.setAttribute('contenteditable', true);

    inp.addEventListener('input', this.update.bind(this), false);
    inp.addEventListener('keydown', this.keydown.bind(this), false);
    inp.addEventListener('paste', this.paste.bind(this), false);
   

    shadow.appendChild(wrapper);
    shadow.appendChild(style);

    wrapper.appendChild(placeholder);
    wrapper.appendChild(inp);
    wrapper.appendChild(outp);

    this._children = {
      placeholder, inp, outp
    };
    if(this.hasAttribute('value')){
      this._value = this.getAttribute('value');
      this.checkvalue();
    }
    this.shadow = shadow;
  }

  checkvalue(){
    if( this._value.length > 0 ){
      this._children.placeholder.style.display = 'none';
    }else{
      this._children.placeholder.style.display = 'block';
    } 
    this._children.outp.innerHTML = this._value;
  }

  set value(v){
    this._value = v;
    this.checkvalue();
  }

  get value(){
    return this._value;
  }

  update(e){
    var str = e.target.innerText;
    str = str
      .replace(/[<>\&]/gim, (i)=>'&#' + i.charCodeAt(0) + ';')
      .replace(/\n/g, "&nbsp;\n<br />")
      .replace(/^(#\S+)/g, "<span class='hashtag'>$1</span>")
      .replace(/([^\&])(#\S+)/g, "$1<span class='hashtag'>$2</span>")
      .replace(/^(@\S+)/g, "<span class='mention'>$1</span>")
      .replace(/([^\&])(@\S+)/g, "$1<span class='mention'>$2</span>");
    this.value = str;
  }

  putAtCaret(content){
    let sel, range;
    if( this.shadow.getSelection ){
      sel = this.shadow.getSelection();
      if( sel.getRangeAt && sel.rangeCount ){
        range = sel.getRangeAt(0);
        range.deleteContents();
        var el = document.createElement('div');
        el.innerHTML = content;
        var frag = document.createDocumentFragment(), node, lastNode;
        while( (node=el.firstChild) ){
          lastNode = frag.appendChild(node);
        }
        range.insertNode(frag);
        if( lastNode ){
          range = range.cloneRange();
          range.setStartAfter(lastNode);
          range.setEndAfter(lastNode);
          range.collapse(true);
          sel.removeAllRanges();
          sel.addRange(range);
        }
      }
      this.update({ target:this._children.inp});
    }
  }

  keydown(e){
      if( e.keyCode == 13 ){
        e.preventDefault();
        this.putAtCaret(' \n<br>\u200B');
        return false;
      }
  }
  
  paste(e){
    e.preventDefault();
    var data = (e.clipboardData || window.clipboardData).getData('Text').replace(/\r/g, '').replace(/\n/g, '\n<br />');
    document.execCommand('insertHTML', false, data);
  }
}

customElements.define('mini-editor', MiniEditor);
    </script>    
</body>

</html>